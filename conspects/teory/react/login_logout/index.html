<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <h1>LogIn LogOut</h1>
    <p>В двух словах что происходит при логинизации. Мы отправляем на сервер данные пользователя как правило это логин и пароль (в качестве логина у нас будет адрес электронной почты). Сервер обрабатывает присланные данные и зашивает в cookie идентификатор. Значит что бы залогинится с нашей старницы нам надо создать POST запрос и передать в качестве тела запроса данные с формы. После того как сервер выдаст статус ответа "без ошибок", мы запускаем <b>thunk</b> который делает запрос на сервер с вопросом "МЫ АВТОРИЗОВАНЫ?", если да, то сервер возвращает нам наш ID, EMAIL и LOGIN. После этого мы полученные данные диспатчим в state. В state мы храним еще один показатель - <b>isAuth</b>, который содержит булевое значение: true - если мы авторизованы и false если нет. В зависимости от этого показателя нам будут доступны разделы сайта. Для лучшего понимания нарисуем схему:</p>
    <img src="prim2.jpg" alt="">
    <h2>Теперь код</h2>
    <p> Начнем с того что создадим метод в REST API</p>
    <img src="prim1.jpg" alt="">
    <p>Теперь нужно создать thunk которая будет делать запросы на сервер и диспатчить результат ответа</p>
    <img src="prim3.jpg" alt="">
    <p>Теперь посмотрим на thunk который запрашивает данные авторизованного пользователя</p>
    <img src="prim4.jpg" alt="">
    <p>Данные которые мы передали запишутся в state? после того как state будет изменен, произойдет перерисовка страницы. На странице логина мы записываем условие:</p>
    <img src="prim5.jpg" alt="">
    <p>Что бы thunk <b>login</b> запускался при submit формы протаскиваем через пропсы функцию до компоненте и указываем ее на обработчике события submit</p>
    <img src="prim6.jpg" alt="">
    <h2>Logout</h2>
    <p>Что должно произойти если мы нажмем на кнопку LogOut? на сервер отправится <b>DELETE</b> запрос. При таком запросе никакие данные на сервер не отсылаются, сервер сам почистит в cookie свой идентификатор. После того как мы отправили delete запрос нам надо вызвать dispatch на вход которому передадим action с пустыми (null) параметрами</p>
    <p>api</p>
    <img src="prim7.jpg" alt="">
    <p>thunk</p>
    <img src="prim8.jpg" alt="">
    <h2>Как обработать не верно введенный логин или пароль</h2>
    <p>Если после отправки введенных данных сервер нам вернул ошибку, т.е. response.data.resultCode !== 0 то мы должны посмотреть что именно нам вернул сервер скорее всего там будет в data зашито какое-то сообщение. </p>
    <img src="prim9.jpg" alt="">
    <p>После этого нам нужно создать action с помощью метода <b>stopSubmit</b> этот метод  мы импортируем из библиотеки <b>redux-form</b></p>
    <img src="prim10.jpg" alt="">
    <p>stopSubmit принимает два аргумента. первый аргумент - это имя формы. Имя формы мы указывали при создании формы с помощью reduxForm. Второй аргумент принимает объект с одним ключем. В качестве ключа (имени свойства мы указываем либо имя филда, либо можем использовать глобальное имя <b>_error</b>) в качестве значения мы передаем текст сообщения, которое получили от сервера</p>
    <img src="prim11.jpg" alt="">
    <p>Этот же код можно написать короче: </p>
    <img src="prim12.jpg" alt="">
    <p>Теперь переходим в компоненту которая отрисовывает нашу форму и там вводим вот такой код:</p>
    <img src="prim13.jpg" alt="">
    <p>Form-redux прокинет в пропсы свойство error в случае ошибки там будет текст ошибки. Если он есть то отображаем блок внутри которого помещаем текст ошибки</p>
    <img src="prim14.jpg" alt="">

</body>
</html>