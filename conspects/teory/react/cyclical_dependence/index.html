<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <h1>Циклическая зависимость</h1>
    <p>Циклическая зависимость это когда два файла импортируют друг другу данные (state или функции)</p>
    <p>Рассмотрим пример: у нас есть два файла <b>index.js</b> и <b>state.js</b></p>
    <p><strong>index.js</strong> содержит в себе функцию render-а которыую мы вынесли в отдельную переменную, но эту функцию мы НЕ ЭКСПОРТИРУЕМ</p>
    <img src="prim1.jpg" alt="">
    <p>В файле <strong>state.js</strong> мы имеем сам state и функции изменения этого state. Что бы каждое изменение state у нас отображалось мы должны в функции изменения state вызывать функцию render. Но так как мы из state.js импортируем в index.js данные, то мы не можем импортировать из index.js в state.js функцию render так как это породит <b>циклическую зависимость</b>. Для выхода из ситуации будем использовать <b>callback</b></p>
    <p>Сначала в index.js мы создадим функцию заглушку, которая ничего полезного делать не будет. <span class="red">ВАЖНО</span> эту функцию объявлять не через const, а через let т.к. потом мы будем эту функцию переопределять. Назовем эту функцию <b>renderDomFromState</b></p>
    <img src="prim2.jpg" alt="">
    <p>Теперь вызовем эту функцию-заглушку в функции изменения state (в примере это просто изменение значения переменной)</p>
    <img src="prim3.jpg" alt="">
    <p>Теперь самое важное! Мы создадим функцию в файле state.js, которая будет принимать в качестве аргумента другую функцию и записывать ее в переменную <b>renderDomFromState</b> и эту функцию мы будем экспортировать. Назовем мы ее <b>subscribe</b></p>
    <img src="prim4.jpg" alt="">
    <p>Теперь переходим в файл index.js и импортируем туда нашу функцию <b>subscribe</b> вызовем ее и в качестве аргумента передадим функцию renderDom</p>
    <img src="prim5.jpg" alt="">
    <p>Вот и все! state.js получил функцию renderDom и записать ее в переменную renderDomFromState. И нет никакой циклической зависимости. У нас импорт происходит только из state в index</p>
</body>
</html>