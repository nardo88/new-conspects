<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <h1>Хок withRouter</h1>
    <p>До этого времени мы использовали вот такую схему</p>
    <img src="prim1.jpg" alt="">
    <p>У нас есть некий BLL где хранятся данные, на соснований этих данных мы отрисовываем компоненты (UI). Но на самом деле все это время у нас был как бы еще один state. Этот state хранился в URL строке, ведь в зависимости от этого значения мы отображали с помощью Router тот или иной компонент.</p>
    <h2>Рассмотрим пример:</h2>
    <p>Допустим что у нас есть страница которая отображает список пользователей. Каждый пользователь (ну или аватарка пользователя) это ссылка <b>NavLink</b> которая меняет строку URL-а, а в зависимостри от значения URL React отрисовывает нужную компоненту. В итогде кликая по пользователю меняется URL и соответственно загружается компонента с профилем страницы.</p>
    <img src="prim2.jpg" alt="">
    <p>Обратим внимание на то, что в атрибуте <strong>to</strong> мы добавили то, что в адресе еще отображается ID пользователя.</p>
    <p>Задача UI компоненты считать этот ID и передать его контейнеру, что бы тот с помощью <b>axios</b> выполнил GET запрос на сервер с указанием id пользователя в URL адресе.</p>
    <h3>Как компонента может прочитать URL адрес?</h3>
    <p>Для того что бы прочитать URL мы будем использовать фунцию <b>withRouter</b></p>
    <h2>withRouter</h2>
    <p><b>withRouter</b> - принимает в качестве аргумента компоненту и возвращает новую компоненту, на которая имеет все теже пропсы и свойства что и предыдущая но в добавок к этому она получает пропсы которые доают возможность считывать информацию из URL</p>
    <p>Теперь встает вопрос, какую именно компоненту нужно передавать функции <b>withRouter</b>? рассмотрим нашу схему:</p>
    <img src="prim3.jpg" alt="">
    <p>Согласно схеме <b>App.js</b> у нас отрисовывает <b>ProfileContainet</b> - контейнерную компоненту, которая получена в результате функции <b>connect</b> библиотеки react-redux. В эту компоненту приходит state, dispatch и action creator из reducer. Контейнерная компонента отрисовывает классовую компоненту, которая так же считается контейнерной для компоненты <b>Profile</b>. Контейнерная компонента имеет метод жизненного цикла <b>componentDidMount</b> который выполняет GET запрос на сервер с помощью метода <b>axios</b>. В URL адресе мы обязательно должны указывать ID пользователя профиль которого нам вернет сервер. Значит id пользователя должна получить именно классовая компонента, что бы выполнить правильный запрос на сервер, поэтому функции <b>withRouter</b> мы передадим именно классовую компоненту, а контейнерной уже передадим результат функции withRouter</p>
    <img src="prim4.jpg" alt="">
    <p>и уже эту новую компоненту передадим в <b>connect</b></p>
    <img src="prim5.jpg" alt="">
    <p>Теперь у классовой компоненты появятся новые пропсы</p>
    <img src="prim6.jpg" alt="">
    <p>Среди новых пропсов нам понядобится <b>match</b> у которого есть свойства: <strong>isExact</strong> и <strong>params</strong></p>
    <p>О чем говорит <b>isExact</b>? в компоненте App.js мы отрисовываем компоненты используя роутинг (Route)</p>
    <img src="prim7.jpg" alt="">
    <p>У компоненты Route есть атрибут <b>path</b> - если URL адрес соответствует значению path то отрисовывается компонента которая указана в атрибуте <b>render</b>. Но по нажатии по ссылке (пользователю) в NavLink мы указали `/profile/${user.id}` а это значит что URL адрес соответствует значению path компонента Router лишь частично. Вот свойство <strong>isExact</strong> и говорит нам соотвествует ли URL значению атрибута path. В нашем случае значение false, не соответсвует. Что бы это исправить нужно добавить параметр атрибуту path компоненты Router. Вот как это выглядит:</p>
    <img src="prim8.jpg" alt="">
    <p>Т.е. после дефолтного пути ставим слеш, двоеточие и имя параметра</p>
    <p>Теперь если посмотреть на пропсы лассовой компоненты, то мы увидим вот такую картину:</p>
    <img src="prim9.jpg" alt="">
    <p>Все что нам остается это в axios запросе использовать значение ID полученное через пропсы</p>
    <p>Объявляем переменную idUser и с помощью строковой интерполяции помещаем ее значениев URL</p>
    <img src="prim10.jpg" alt="">
    <h2>Баги</h2>
    <p>Теперь если открыть просто ссылку /profile у нас ничего не загрузится. Что бы это исправить нам нужно сделать параметр userId у Router не обязательным, для этого в конце path ставим знак вопроса</p>
    <img src="prim11.jpg" alt="">
    <p>А перед axios запросом ставим условие, если idUser вернет false то присваиваем значение по умолчанию - например ID своей страницы.</p>
    <img src="prim12.jpg" alt="">



</body>
</html>